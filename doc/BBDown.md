# BBDown 使用教程

在开发中，我使用了 [BBDown](https://github.com/nilaoda/BBDown) 作为哔哩哔哩下载器 

该项目需要自备ffmpeg（添加到环境变量）才可以使用

最简单的参考命令 ``BBDown.exe https://www.bilibili.com/video/BV15j411e7fJ``

官方仓库访问 https://github.com/nilaoda/BBDown

# 要点

境内默认强制使用 ``upos-sz-mirrorcoso1.bilivideo.com`` 做数据源

热门视频通常有AVC+HEVC+AV1三种编码。

冷门视频通常只有AVC（哪怕你是HEVC、AV1格式上传的）。

该程序在未登录时可实现1080P30FPS的下载。

似乎默认使用最高码率的AVC+M4A进行下载后合并

考虑到编码的性能开销，建议下载和合并都用AVC，如果缺流量用HEVC。如果需要HEVC、AV1等格式建议后期再转换。

该程序默认情况下会返回哔哩哔哩的视频AV ID，根据组合即可留存URL（如果后续需要传递的话）。

## 主要参数

-intl, --use-intl-api   使用国际版(东南亚视频)解析模式（大陆站使用会返回“该地区无法访问”，应可能是给国际版用户用的）
-e, --encoding-priority <encoding-priority>    视频编码的选择优先级, 用逗号分割 例: "hevc,av1,avc"
-q, --dfn-priority <dfn-priority>              画质优先级,用逗号分隔 例: "8K 超高清, 1080P 高码率, HDR 真彩, 杜比视界"
--work-dir <work-dir>                          设置程序的工作目录
# 示例

在我开发过程中，使用的版本是 https://github.com/nilaoda/BBDown/releases/download/1.6.1/BBDown_1.6.1_20230818_win-x64.zip

## 未安装ffmpeg

```
PS C:\bin> ./BBDown.exe https://www.bilibili.com/video/BV15j411e7fJ
BBDown version 1.6.1, Bilibili Downloader.
遇到问题请首先到以下地址查阅有无相关信息：
https://github.com/nilaoda/BBDown/issues

找不到可执行的ffmpeg文件
```

## 快速无参数下载

### 冷门视频快速无参数下载


```
PS F:\Download> BBDown.exe https://www.bilibili.com/video/BV15j411e7fJ
BBDown version 1.6.1, Bilibili Downloader.
遇到问题请首先到以下地址查阅有无相关信息：
https://github.com/nilaoda/BBDown/issues

[2023-11-01 16:08:20.825] - 检测账号登录...
[2023-11-01 16:08:20.825] - 你尚未登录B站账号, 解析可能受到限制
[2023-11-01 16:08:20.826] - 获取aid...
[2023-11-01 16:08:21.334] - 获取aid结束: 450142918
[2023-11-01 16:08:21.334] - 获取视频信息...
[2023-11-01 16:08:21.464] - 视频标题: 尘白禁区 1.3版本先导剧情
[2023-11-01 16:08:21.464] - 发布时间: 10/26/2023 21:31:26
[2023-11-01 16:08:21.464] - P1: [1312024053] [尘白禁区 1.3版本先导剧情] [02m34s]
[2023-11-01 16:08:21.464] - 共计 1 个分P, 已选择：ALL
[2023-11-01 16:08:21.464] - 开始解析P1...
[2023-11-01 16:08:21.588] - 下载封面...
[2023-11-01 16:08:21.981] - 共计4条视频流.
                            0. [1080P 高清] [1920x1080] [AVC] [30.303] [2596 kbps] [~48.80 MB]
                            1. [720P 高清] [1280x720] [AVC] [30.303] [1731 kbps] [~32.54 MB]
                            2. [480P 清晰] [852x480] [AVC] [30.303] [781 kbps] [~14.68 MB]
                            3. [360P 流畅] [640x360] [AVC] [30.303] [349 kbps] [~6.56 MB]
[2023-11-01 16:08:21.981] - 共计3条音频流.
                            0. [M4A] [131 kbps] [~2.46 MB]
                            1. [M4A] [112 kbps] [~2.11 MB]
                            2. [M4A] [51 kbps] [~981.75 KB]
[2023-11-01 16:08:21.982] - 已选择的流:
                            [视频] [1080P 高清] [1920x1080] [AVC] [30.303] [2596 kbps] [~48.48 MB]
                            [音频] [M4A] [131 kbps] [~2.45 MB]
[2023-11-01 16:08:21.982] - 尝试将视频流强制替换为upos-sz-mirrorcoso1.bilivideo.com……
[2023-11-01 16:08:21.983] - 尝试将音频流强制替换为upos-sz-mirrorcoso1.bilivideo.com……
[2023-11-01 16:08:21.983] - 开始多线程下载P1视频...
[2023-11-01 16:08:32.498] - 合并视频分片...
[2023-11-01 16:08:32.515] - 清理分片...
[2023-11-01 16:08:32.519] - 开始多线程下载P1音频...
[2023-11-01 16:08:34.152] - 合并音频分片...
[2023-11-01 16:08:34.153] - 清理分片...
[2023-11-01 16:08:34.153] - 下载P1完毕
[2023-11-01 16:08:34.153] - 开始合并音视频...
[2023-11-01 16:08:34.292] - 清理临时文件...
[2023-11-01 16:08:34.499] - 任务完成
```

### 热门视频快速无参数下载



```
PS F:\Download> BBDown.exe https://www.bilibili.com/video/BV1kj411a7w9/
BBDown version 1.6.1, Bilibili Downloader.
遇到问题请首先到以下地址查阅有无相关信息：
https://github.com/nilaoda/BBDown/issues

[2023-11-01 16:56:43.789] - 检测账号登录...
[2023-11-01 16:56:43.789] - 你尚未登录B站账号, 解析可能受到限制
[2023-11-01 16:56:43.790] - 获取aid...
[2023-11-01 16:56:44.008] - 获取aid结束: 450370719
[2023-11-01 16:56:44.008] - 获取视频信息...
[2023-11-01 16:56:44.084] - 视频标题: 【科技杂谈101】高通直呼带不动，微软是如何将ARM WINDOWS这张好牌打烂的？
[2023-11-01 16:56:44.085] - 发布时间: 10/31/2023 23:37:06
[2023-11-01 16:56:44.085] - P1: [1317447349] [【科技杂谈101】高通直呼带不动，微软是如何将ARM WINDOWS这张好牌打烂的？] [16m49s]
[2023-11-01 16:56:44.085] - 共计 1 个分P, 已选择：ALL
[2023-11-01 16:56:44.085] - 开始解析P1...
[2023-11-01 16:56:44.248] - 下载封面...
[2023-11-01 16:56:44.631] - 共计12条视频流.
                            0. [1080P 高清] [1920x1080] [AVC] [29.412] [1529 kbps] [~188.33 MB]
                            1. [1080P 高清] [1920x1080] [AV1] [30.019] [918 kbps] [~113.07 MB]
                            2. [1080P 高清] [1920x1080] [HEVC] [30.303] [724 kbps] [~89.17 MB]
                            3. [720P 高清] [1280x720] [AVC] [29.412] [1135 kbps] [~139.80 MB]
                            4. [720P 高清] [1280x720] [AV1] [30.019] [433 kbps] [~53.33 MB]
                            5. [720P 高清] [1280x720] [HEVC] [30.303] [366 kbps] [~45.08 MB]
                            6. [480P 清晰] [852x480] [AVC] [29.412] [591 kbps] [~72.79 MB]
                            7. [480P 清晰] [852x480] [AV1] [30.019] [259 kbps] [~31.90 MB]
                            8. [480P 清晰] [852x480] [HEVC] [30.303] [238 kbps] [~29.31 MB]
                            9. [360P 流畅] [640x360] [AVC] [29.412] [379 kbps] [~46.68 MB]
                            10. [360P 流畅] [640x360] [AV1] [30.019] [181 kbps] [~22.29 MB]
                            11. [360P 流畅] [640x360] [HEVC] [30.303] [165 kbps] [~20.32 MB]
[2023-11-01 16:56:44.632] - 共计3条音频流.
                            0. [M4A] [110 kbps] [~13.55 MB]
                            1. [M4A] [93 kbps] [~11.45 MB]
                            2. [M4A] [40 kbps] [~4.93 MB]
[2023-11-01 16:56:44.632] - 已选择的流:
                            [视频] [1080P 高清] [1920x1080] [AVC] [29.412] [1529 kbps] [~188.14 MB]
                            [音频] [M4A] [110 kbps] [~13.54 MB]
[2023-11-01 16:56:44.633] - 尝试将视频流强制替换为upos-sz-mirrorcoso1.bilivideo.com……
[2023-11-01 16:56:44.633] - 尝试将音频流强制替换为upos-sz-mirrorcoso1.bilivideo.com……
[2023-11-01 16:56:44.633] - 开始多线程下载P1视频...
[2023-11-01 16:56:46.498] - 合并视频分片...
[2023-11-01 16:56:46.565] - 清理分片...
[2023-11-01 16:56:46.579] - 开始多线程下载P1音频...
[2023-11-01 16:56:51.775] - 合并音频分片...
[2023-11-01 16:56:51.776] - 清理分片...
[2023-11-01 16:56:51.776] - 下载P1完毕
[2023-11-01 16:56:51.776] - 开始合并音视频...
[2023-11-01 16:56:52.886] - 清理临时文件...
[2023-11-01 16:56:53.114] - 任务完成
```

